<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Goblin's Village – Admin</title>
  <link rel="stylesheet" href="../assets/css/style.css" />
  <style>
    .admin-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .admin-card {
      background: rgba(0, 0, 0, 0.4);
      border: 2px solid #5c401d;
      border-radius: 8px;
      padding: 16px;
      color: #f5e6d3;
    }

    .admin-card h3 {
      margin-top: 0;
      color: #f0c674;
    }

    .admin-card label {
      display: block;
      font-weight: bold;
      margin: 12px 0 6px;
      color: #f5e6d3;
    }

    .admin-card input,
    .admin-card textarea {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #5c401d;
      background: rgba(0, 0, 0, 0.6);
      color: #f5e6d3;
      font-family: 'Lato', sans-serif;
      box-sizing: border-box;
    }

    .admin-card textarea {
      min-height: 120px;
      resize: vertical;
    }

    .admin-actions {
      margin-top: 12px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .admin-output textarea {
      min-height: 320px;
      background: rgba(0, 0, 0, 0.6);
      color: #f5e6d3;
      font-family: 'Courier New', monospace;
    }

    .helper-text {
      color: #dcc6a0;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }

    @media (max-width: 900px) {
      .admin-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="goblin-ui-wrapper">
    <div id="site-header"></div>

    <main>
      <div class="goblin-town-square">
        <div class="town-col-center" style="width:100%; max-width:1100px;">
          <div class="parchment-box">
            <h1 class="news-title">Static Page Generator</h1>
            <p class="helper-text">Fill out the fields below to produce a full HTML file that uses the shared header, footer, and layout script. Copy the result into a new file in the repository.</p>

            <div class="admin-grid">
              <div class="admin-card">
                <h3>Page Details</h3>
                <label for="page-title">Page title</label>
                <input id="page-title" type="text" placeholder="The Goblin's Village – New Page" />

                <label for="page-path">Output file path</label>
                <input id="page-path" type="text" placeholder="generators/my-new-generator.html" />

                <label for="page-body">Main content (goes inside &lt;main&gt;)</label>
                <textarea id="page-body" placeholder="Paste your page content here..."></textarea>

                <div class="admin-actions">
                  <button id="generate-page" class="goblin-btn" type="button">Generate page HTML</button>
                </div>
              </div>

              <div class="admin-card admin-output">
                <h3>Generated HTML</h3>
                <p class="helper-text">The text below is read-only. Copy it into a new file at the path you specified.</p>
                <textarea id="generated-output" readonly></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div id="site-footer"></div>
  </div>

  <script src="../assets/js/layout.js"></script>
  <script>
    const pageTitleInput = document.getElementById('page-title');
    const pagePathInput = document.getElementById('page-path');
    const pageBodyInput = document.getElementById('page-body');
    const outputArea = document.getElementById('generated-output');
    const generateButton = document.getElementById('generate-page');

    function getAssetPrefix(targetPath) {
      if (!targetPath) return '';
      const sanitizedPath = targetPath.startsWith('/') ? targetPath.slice(1) : targetPath;
      const parts = sanitizedPath.split('/').filter(Boolean);
      const depth = parts.length > 1 ? parts.length - 1 : 0;
      return depth > 0 ? '../'.repeat(depth) : '';
    }

    function buildPageHtml(title, filePath, bodyContent) {
      const safeTitle = title || "The Goblin's Village";
      const prefix = getAssetPrefix(filePath);
      const cssPath = `${prefix}assets/css/style.css`;
      const layoutPath = `${prefix}assets/js/layout.js`;

      return `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>${safeTitle}</title>
  <link rel="stylesheet" href="${cssPath}" />
</head>
<body>
  <div class="goblin-ui-wrapper">
    <div id="site-header"></div>

    <main>
${bodyContent}
    </main>

    <div id="site-footer"></div>
  </div>

  <script src="${layoutPath}"></script>
</body>
</html>`;
    }

    generateButton.addEventListener('click', () => {
      const title = pageTitleInput.value.trim();
      const filePath = pagePathInput.value.trim();
      const bodyContent = pageBodyInput.value || '';
      outputArea.value = buildPageHtml(title, filePath, bodyContent);
      outputArea.focus();
      outputArea.select();
    });
  </script>
</body>
</html>
